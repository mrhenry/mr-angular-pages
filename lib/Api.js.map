{"version":3,"sources":["../src/Api.js"],"names":[],"mappings":"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","file":"Api.js","sourcesContent":["import {beforeBoot} from 'fd-angular-core';\nimport {currentLoader} from './index';\n\nlet summariesPromise;\n\nbeforeBoot(fetchSummaries);\n\nexport function fetchSummaries() {\n\tif (summariesPromise) {\n\t\treturn summariesPromise;\n\t}\n\tsummariesPromise = currentLoader.summaries().then(makeTree);\n\treturn summariesPromise;\n}\n\nfunction makeTree(data) {\n\tlet pages = (data.pages || []);\n\tlet pagesById = {};\n\tlet pagesByPath = {};\n\tlet roots = [];\n\n\tif (navigator.language) {\n\t\tlet locale = navigator.language.split('-')[0];\n\t\tif (data.i18n.locales.indexOf(locale) < 0) {\n\t\t\tlocale = data.i18n.default;\n\t\t}\n\t\tdata.i18n.current = locale;\n\t}\n\tif (!data.i18n.current) {\n\t\tdata.i18n.current = data.i18n.default;\n\t}\n\n\t// localize\n\tlet lpages = [];\n\tfor (let locale of data.i18n.locales) {\n\t\tfor (let page of pages) {\n\t\t\tlet clone = {};\n\t\t\tObject.assign(clone, page);\n\t\t\tclone.translations = undefined;\n\t\t\tclone.id = `${locale}/${page.id}`;\n\n\t\t\tlet localeTranslations, defaultTranslations;\n\t\t\tfor (let t of page.translations) {\n\t\t\t\tif (t.locale === locale) {\n\t\t\t\t\tlocaleTranslations = t;\n\t\t\t\t}\n\t\t\t\tif (t.locale === data.i18n.default) {\n\t\t\t\t\tdefaultTranslations = t;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tObject.assign(clone, defaultTranslations);\n\t\t\tfor (let key of Object.keys(localeTranslations)) {\n\t\t\t\tlet val = localeTranslations[key];\n\t\t\t\tif (!isBlank(val)) {\n\t\t\t\t\tclone[key] = val;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tclone.locale = locale;\n\t\t\tif (isBlank(clone.long_title)) {\n\t\t\t\t/* eslint camelcase:0 */\n\t\t\t\tclone.long_title = clone.title;\n\t\t\t}\n\n\t\t\tif (page.parent_id) {\n\t\t\t\tclone.parent_id = `${locale}/${page.parent_id}`;\n\t\t\t}\n\n\t\t\tpagesById[clone.id] = clone;\n\t\t\tlpages.push(clone);\n\t\t}\n\t}\n\tpages = lpages;\n\n\t// resolve parent pages\n\tfor (let page of pages) {\n\t\tif (page.parent_id) {\n\t\t\tlet parent = pagesById[page.parent_id];\n\t\t\tif (!parent.child_ids) {\n\t\t\t\tparent.child_ids = [];\n\t\t\t}\n\t\t\tparent.child_ids.push(page.id);\n\t\t\tpage.parent = parent;\n\t\t} else {\n\t\t\troots.push(page);\n\t\t}\n\t}\n\troots.sort(positionSort);\n\n\t// resolve child pages\n\tfor (let page of pages) {\n\t\tif (page.child_ids) {\n\t\t\tlet children = [];\n\t\t\tfor (let id of page.child_ids) {\n\t\t\t\tlet child = pagesById[id];\n\t\t\t\tif (child) {\n\t\t\t\t\tchildren.push(child);\n\t\t\t\t}\n\t\t\t}\n\t\t\tchildren.sort(positionSort);\n\t\t\tpage.children = children;\n\t\t} else {\n\t\t\tpage.children = [];\n\t\t}\n\t}\n\n\t// map by path\n\tfor (let page of roots) {\n\t\tmakePath(page, `/${page.locale}`, pagesByPath);\n\t\tif (page.locale === data.i18n.current) {\n\t\t\tmakePath(page, `/`, pagesByPath);\n\t\t}\n\t}\n\n\treturn {\n\t\ttypes: data.types,\n\t\ti18n:  data.i18n,\n\t\tpages: pagesByPath,\n\t};\n\n\tfunction makePath(page, prefix, acc, root) {\n\n\t\tlet slug = pageSlug(page);\n\t\tlet path = pathJoin(prefix, slug);\n\n\t\tif (!root) {\n\t\t\troot = page;\n\t\t}\n\n\t\tpage.root = root;\n\t\tpage.path = path;\n\t\tacc[path] = page;\n\n\t\tfor (let child of page.children) {\n\t\t\tmakePath(child, path, acc, root);\n\t\t}\n\t}\n\n\tfunction positionSort(a, b) {\n\t\tlet posa = (a.position || 0);\n\t\tlet posb = (b.position || 0);\n\t\treturn posa - posb;\n\t}\n\n\tfunction pageSlug(page) {\n\t\tif (typeof page.path_component === 'string') {\n\t\t\treturn page.path_component;\n\t\t}\n\t\tif (typeof page.static_uuid === 'string') {\n\t\t\treturn page.static_uuid;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tfunction pathJoin(prefix, suffix) {\n\t\tif (suffix === '') {\n\t\t\treturn prefix;\n\t\t}\n\t\tif (prefix === '/') {\n\t\t\treturn `/${suffix}`;\n\t\t}\n\t\treturn `${prefix}/${suffix}`;\n\t}\n\n\tfunction isBlank(val) {\n\t\treturn val === undefined || val === null && val === '';\n\t}\n}\n"]}