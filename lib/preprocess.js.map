{"version":3,"sources":["../src/preprocess.js"],"names":[],"mappings":";;;;;QAiBgB,UAAU,GAAV,UAAU;QAIV,gBAAgB,GAAhB,gBAAgB;;qBArBZ,SAAS;;AAE7B,IAAI,aAAa,GAAG,EAAE,CAAC;;;;;;;;;;;;;;;;AAehB,SAAS,UAAU,CAAC,IAAI,EAAE;AAChC,cAAa,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;CACzB;;AAEM,SAAS,gBAAgB,CAAC,IAAI,EAAE;AACtC,QAAO,AAAM,GAAG,MAAT,IAAI,EAAM,aAAa,CAAC,CAAC;CAChC;;;AAGD,SAAS,GAAG,CAAC,KAAK,EAAS;KAAP,GAAG,yDAAC,CAAC;;AACxB,KAAI,MAAM,GAAG,IAAI,CAAC;AAClB,KAAI,CAAC,MAAM,CAAC,IAAI,EAAE;AACjB,QAAM,GAAG,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;EACjC;;AAED,KAAI,GAAG,GAAG,KAAK,CAAC,MAAM,EAAE;;;AACvB,SAAO,YAAA,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,EAAE,GAAG,iBAAC,KAAK,EAAE,GAAG,GAAG,CAAC,CAAC,CAAC;EACpD;;AAED,QAAO,MAAM,CAAC;CACd;;AAED,UAAU,CAAC,SAAS,eAAe,CAAC,IAAI,EAAE;AACzC,QAAO,OAxCA,KAAK,MAwCL,IAAI,EAAQ,UAAA,IAAI,EAAI;AAC1B,MAAI,IAAI,CAAC,MAAM,EAAE;AAChB,OAAI,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC,KAAK,GAAG,CAAC,CAAC;GACnC,MAAM;AACN,OAAI,CAAC,KAAK,GAAG,CAAC,CAAC;GACf;EACD,CAAC,CAAC;CACH,CAAC,CAAC","file":"preprocess.js","sourcesContent":["import {visit} from './query';\n\nlet preprocessors = [];\n\n/**\nCallbacks passed to preprocess are executed before the page-state tree is build.\nThe callback is called with each root page.\n\n@function preprocess\n@param {preprocessCallback} func\n@returns {Promise}\n*/\n/**\n@callback preprocessCallback\n@param {Object} page\n@returns {?Promise}\n*/\nexport function preprocess(func) {\n\tpreprocessors.push(func);\n}\n\nexport function runPreprocessors(root) {\n\treturn root::seq(preprocessors);\n}\n\n// Run functions returning promises sequentialy\nfunction seq(funcs, idx=0) {\n\tlet target = this;\n\tif (!target.then) {\n\t\ttarget = Promise.resolve(target);\n\t}\n\n\tif (idx < funcs.length) {\n\t\treturn target.then(funcs[idx])::seq(funcs, idx + 1);\n\t}\n\n\treturn target;\n}\n\npreprocess(function addDepthToPages(root) {\n\treturn root::visit(page => {\n\t\tif (page.parent) {\n\t\t\tpage.depth = page.parent.depth + 1;\n\t\t} else {\n\t\t\tpage.depth = 0;\n\t\t}\n\t});\n});\n"]}